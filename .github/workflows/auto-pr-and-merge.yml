name: Auto-PR and Merge for Incoming Branches

on:
  push:
    branches:
      - incoming-bios
      - incoming-cmo-report

permissions:
  contents: write
  pull-requests: write

jobs:
  open-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create or update pull request
        id: cpr
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref_name }}
          base: main
          title: |
            üìù Auto-generated update from ${{ github.ref_name }}
          body: |
            This PR contains new or updated content pushed from Google Forms.

            **Branch:** ${{ github.ref_name }}
            **Committer:** ${{ github.actor }}

            Review and approve to merge into production.
          labels: automated, auto-generated
          assignees: JustinXHale
          delete-branch: false
          draft: false
          branch-suffix: none

  auto-merge:
    needs: open-pr
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Enable auto-merge for approved PRs
        uses: peter-evans/enable-pull-request-automerge@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          merge-method: squash
